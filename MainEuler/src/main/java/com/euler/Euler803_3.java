package com.euler;

import java.math.BigInteger;

import com.google.common.math.LongMath;

public class Euler803_3 {
	private final static BigInteger F=BigInteger.valueOf(25214903917l);
	private final static BigInteger K=BigInteger.valueOf(11);
	private final static BigInteger MOD=BigInteger.valueOf(LongMath.pow(2l,48));
	
	// private final static BigInteger A0=BigInteger.valueOf(123456);
	private final static BigInteger A0=BigInteger.valueOf(78580612777175l);
	
	private static class HackishBuffer	{
		private final static int LEN=16;
		private final char[] buffer;
		private int position;
		public long actualPosition;
		public HackishBuffer()	{
			buffer=new char[LEN];
			position=0;
		}
		public void put(char c)	{
			++actualPosition;
			buffer[position]=c;
			position=(position+1)&15;
		}
		public boolean checkAgainst(char[] vals)	{
			int curPos=(position-vals.length)&15;
			for (char c:vals)	{
				if (buffer[curPos]!=c) return false;
				curPos=(curPos+1)&15;
			}
			return true;
		}
	}
	
	// "P" -> 152 (!!)
	// "Pu" -> 153 :D
	// "Puz" -> 70004 :(
	// "Puzz" -> 2206134
	// "Puzzl" -> 192097862, 18 seconds.
	// "Puzzle" -> 3169968677, 339 seconds.
	// Â¿Echarle un ojete a https://www.violentlymild.com/posts/reverse-engineering-linear-congruential-generators/?
	// See also https://www.pnas.org/doi/10.1073/pnas.61.1.25.
	
	/*-
	Iterations: 13169968676
	Last an: 258337257566816.
	Elapsed 322.6295453 seconds 
	 */
	public static void main(String[] args)	{
		// char[] toCheck="RxqLBfWzv".toCharArray();
		char[] toCheck="Puzzl".toCharArray();
		char lastChar=toCheck[toCheck.length-1];
		HackishBuffer buffer=new HackishBuffer();
		BigInteger a=A0;
		for (;;)	{
			long b=(a.longValueExact()>>16)%52;
			char c=(char)((b<=25)?(b+'a'):(b-26+'A'));
			buffer.put(c);
			if ((lastChar==c)&&(buffer.checkAgainst(toCheck)))	{
				System.out.println("Iterations: "+(1+buffer.actualPosition));
				System.out.println("Last an: "+a.toString()+". Last an BINARY: "+a.toString(2)+".");
				// break;
			}
			a=a.multiply(F).add(K).mod(MOD);
			/*-
			 * Some output...
			Iterations: 1192097861
			Last an: 135569551859595. Last an BINARY: 11110110100110010111110111110110001111110001011.
			Iterations: 1355175289
			Last an: 274246761924911. Last an BINARY: 111110010110110100001100110100110100100100101111.
			Iterations: 1489626485
			Last an: 32472628178811. Last an BINARY: 111011000100010011111011101111010111101111011.
			Iterations: 1648780021
			Last an: 41258813973243. Last an BINARY: 1001011000011001010000111100110110001011111011.
			Iterations: 12736335371
			Last an: 148459217716561. Last an BINARY: 100001110000010111011010111011111000010101010001.
			Iterations: 13169968675
			Last an: 45015007963785. Last an BINARY: 1010001111000011011111100011110010101010001001.
			Iterations: 13947986055
			Last an: 94956918902269. Last an BINARY: 10101100101110011100001011010111000110111111101.
			Iterations: 14115811355
			Last an: 56945541849889. Last an BINARY: 1100111100101010101010110010110010001100100001.
			Iterations: 14330452622
			Last an: 134822430469122. Last an BINARY: 11110101001111011001011000100110110110000000010.
			Iterations: 15849036864
			Last an: 164206316087996. Last an BINARY: 100101010101100001000011001000111110101010111100.
			Iterations: 16154374774
			Last an: 19294792666218. Last an BINARY: 100011000110001101011010000110100110001101010.
			Iterations: 16929941155
			Last an: 86604401838345. Last an BINARY: 10011101100010000101000100110111000100100001001.
			Iterations: 18044581477
			Last an: 17949340980267. Last an BINARY: 100000101001100101000000101111101010000101011.
			Iterations: 18216547941
			Last an: 85788403946539. Last an BINARY: 10011100000011000101011010101111101010000101011.
			Iterations: 18719128330
			Last an: 19479918486430. Last an BINARY: 100011011011110000101100111110010001110011110.
			Iterations: 18951796466
			Last an: 171548848898438. Last an BINARY: 100111000000010111010100001100110100000110000110.
			Iterations: 19160207824
			Last an: 280433249194188. Last an BINARY: 111111110000110101110100001100111001000011001100.
			Iterations: 19251170089
			Last an: 227132750924959. Last an BINARY: 110011101001001101110110111011111000110010011111.
			Iterations: 110050300489
			Last an: 112593532315199. Last an BINARY: 11001100110011100111001011111110110011000111111.
			Iterations: 110388423944
			Last an: 55211272433476. Last an BINARY: 1100100011011011100000010001111110111101000100.
			Iterations: 110439095168
			Last an: 145155800385532. Last an BINARY: 100001000000010010110111111010110100011111111100.
			Iterations: 110808630279
			Last an: 193171486656381. Last an BINARY: 101011111011000000111101110101111100011101111101.
			Iterations: 111017252843
			Last an: 219571790489521. Last an BINARY: 110001111011001100001010100100110010011110110001.
			Iterations: 112226561978
			Last an: 201421191621454. Last an BINARY: 101101110011000100000110100100111010101101001110.
			Iterations: 113320244855
			Last an: 68989486318893. Last an BINARY: 1111101011111011011101110100110100010100101101.
			Iterations: 113899095378
			Last an: 280713406933478. Last an BINARY: 111111110100111010101110111001110110100111100110.
			Iterations: 113955668999
			Last an: 180434786568061. Last an BINARY: 101001000001101010111111010110111100011101111101.
			Iterations: 114632069274
			Last an: 32480040300078. Last an BINARY: 111011000101001011001010000111010111000101110.
			Iterations: 114661690272
			Last an: 234914251752732. Last an BINARY: 110101011010011100111100100001110100010100011100.
			Iterations: 114778887053
			Last an: 14602817443443. Last an BINARY: 11010100011111111011101111110001011001110011.
			Iterations: 114869778039
			Last an: 2313049556269. Last an BINARY: 100001101010001100011111110100010100101101.
			Iterations: 115113074069
			Last an: 12238671030811. Last an BINARY: 10110010000110001001101000111010101000011011.
			Iterations: 115604165113
			Last an: 225821521062319. Last an BINARY: 110011010110001000101011100010111010100110101111.
			Iterations: 115926001285
			Last an: 208074611818699. Last an BINARY: 101111010011111000100101010100110000000011001011.
			Iterations: 116481262238
			Last an: 9777270710802. Last an BINARY: 10001110010001110010101111110110001000010010.
			Iterations: 116780288050
			Last an: 221833711002310. Last an BINARY: 110010011100000110101111100010110010001011000110.
			Iterations: 116841972714
			Last an: 54947966575230. Last an BINARY: 1100011111100110010010000001110110001001111110.
			Iterations: 117438277059
			Last an: 88165674086313. Last an BINARY: 10100000010111110101011101011110110111110101001.
			Iterations: 118087545939
			Last an: 99423456554489. Last an BINARY: 10110100110110011010011110011110110110111111001.
			Iterations: 118185815360
			Last an: 148199421984700. Last an BINARY: 100001101100100101011101111001110011111110111100.
			Iterations: 118313599628
			Last an: 43180213118472. Last an BINARY: 1001110100010110101101010000111010011000001000.
			Iterations: 118318527592
			Last an: 101619274584484. Last an BINARY: 10111000110110000010100110000111001000110100100.
			Iterations: 119131277336
			Last an: 104260020947156. Last an BINARY: 10111101101001011101101100000110100100011010100.
			Iterations: 119547642093
			Last an: 140086546466131. Last an BINARY: 11111110110100001110000110101110000010101010011.
			Iterations: 120105170614
			Last an: 99380496913578. Last an BINARY: 10110100110001011010011001101110101010010101010.
			Iterations: 120118510238
			Last an: 236197809709586. Last an BINARY: 110101101101001000010110100010110110001000010010.
			Iterations: 120556948991
			Last an: 126375856121237. Last an BINARY: 11100101111000000101100000000110010010110010101.
			Iterations: 122413164939
			Last an: 274146086579921. Last an BINARY: 111110010101010110011100000110110110111011010001.
			Iterations: 122441757100
			Last an: 154541519487016. Last an BINARY: 100011001000111000000000010111110100000000101000.
			Iterations: 122781324035
			Last an: 270250623092713. Last an BINARY: 111101011100101010100000011000111100011111101001.
			Iterations: 123220858547
			Last an: 241847114082009. Last an BINARY: 110110111111010101101011010100110010011011011001.
			Iterations: 123837219701
			Last an: 49240149045115. Last an BINARY: 1011001100100010011101100101111010111101111011.
			Iterations: 124280787715
			Last an: 77554027579369. Last an BINARY: 10001101000100011110100010000111100011111101001.
			Iterations: 124836157427
			Last an: 137192762225433. Last an BINARY: 11111001100011010101101110110111011001100011001.
			Iterations: 124858426740
			Last an: 145853824620848. Last an BINARY: 100001001010011100111101011001111101100100110000.
			Iterations: 125561036582
			Last an: 208054457713946. Last an BINARY: 101111010011100101110100000010111100010100011010.
			Iterations: 125793520967
			Last an: 11249948544957. Last an BINARY: 10100011101101010101001011111100111110111101.
			Iterations: 125829148245
			Last an: 34108604358107. Last an BINARY: 111110000010110000111001111110001110111011011.
			Iterations: 126095210220
			Last an: 218966865998696. Last an BINARY: 110001110010011000110010010000111111001101101000.
			Iterations: 126116513385
			Last an: 138178274497759. Last an BINARY: 11111011010110000100010111101111001010011011111.
			Iterations: 126282625091
			Last an: 35404607901737. Last an BINARY: 1000000011001101000111000100111101000000101001.
			Iterations: 126366756324
			Last an: 75183140341792. Last an BINARY: 10001000110000011110000010111111000100000100000.
			Iterations: 126586979938
			Last an: 164895731944950. Last an BINARY: 100101011111100011000111100001110000110111110110.
			Iterations: 126600429644
			Last an: 75846135029192. Last an BINARY: 10001001111101101001101111011111001110111001000.
			Iterations: 126896459890
			Last an: 11368331194118. Last an BINARY: 10100101011011100101010101111010111100000110.
			Iterations: 127603625762
			Last an: 69652596896438. Last an BINARY: 1111110101100101000010010010111011001010110110.
			Iterations: 127926824533
			Last an: 255657532399067. Last an BINARY: 111010001000010011101000011001110001110111011011.
			Iterations: 128443595441
			Last an: 214894806550855. Last an BINARY: 110000110111001000011000100110111100100101000111.
			Iterations: 128535412827
			Last an: 273919759603297. Last an BINARY: 111110010010000011101001111101111101011001100001.
			Iterations: 128686950424
			Last an: 139028017137876. Last an BINARY: 11111100111000111111011100100110100100011010100.
			Iterations: 128782635061
			Last an: 12686911860539. Last an BINARY: 10111000100111100110110111111110111100111011.
			Iterations: 128998068995
			Last an: 268468016367593. Last an BINARY: 111101000010101110010100101111111100011111101001.
			Iterations: 129689065760
			Last an: 48260396035740. Last an BINARY: 1010111110010001111111110000110010111010011100.
			Iterations: 130529463425
			Last an: 118853568295767. Last an BINARY: 11011000001100011000000101101111111001101010111.
			Iterations: 130797492932
			Last an: 133137731939840. Last an BINARY: 11110010001011010001011001101111110111000000000.
			Iterations: 130829555699
			Last an: 138237803213593. Last an BINARY: 11111011011100111111111001001111011001100011001.
			 */
		}
		/*-
		long tac=System.nanoTime();
		double seconds=(tac-tic)*1e-9;
		System.out.println("Elapsed "+seconds+" seconds");
		*/
	}
}
